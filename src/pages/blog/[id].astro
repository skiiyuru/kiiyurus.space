---
export const prerender = true

import { render } from "astro:content"

import FormattedDate from "@/components/ui/FormattedDate.astro"
import Heading from "@/components/ui/Heading.astro"
import BaseLayout from "@/layouts/BaseLayout.astro"
import Container from "@/layouts/Container.astro"
import { Image } from "astro:assets"
import { getCollection } from "astro:content"

import type { GetStaticPaths } from "astro"
import type { CollectionEntry } from "astro:content"

export const getStaticPaths = (async () => {
  const allPosts = await getCollection("posts", (post) => !post.data.isDraft)
  return allPosts.map((post) => {
    return {
      params: {
        id: post.id,
      },
      props: {
        post: post,
      },
    }
  })
}) satisfies GetStaticPaths

type Props = {
  post: CollectionEntry<"posts">
}

const { post } = Astro.props

const { Content } = await render(post)

const { title, description, pubDate, image } = post.data
---

<BaseLayout title={title} description={description}>
  <article
    aria-label=`Article on ${title}`
    class="grid gap-10 bg-zinc-900 px-4 py-10"
  >
    <div class="grid gap-4 text-center">
      <FormattedDate pubDate={pubDate} />
      <Heading classes="font-sans font-bold" tagName="h2">{title}</Heading>
      <p class="max-w-prose text-center text-pretty md:w-4/5 lg:w-3/5">
        {description}
      </p>
    </div>

    <Image
      class="lg:max-w-3xl"
      src={image}
      alt={title}
      width={700}
      height={500}
    />
    <div
      class="prose prose-headings:text-white text-balance text-white font-normal tracking-wider prose-lg prose-code:text-red-400
      prose-a:text-sky-400 prose-a:no-underline prose-h2:text-pretty prose-h3:text-pretty prose-h4:text-pretty"
    >
      <Content />
    </div>
  </article>
  <section aria-label="Post content" class="flex flex-col items-center">
    <article></article>
  </section>
</BaseLayout>
